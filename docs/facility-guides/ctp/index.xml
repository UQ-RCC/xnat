<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Clinical Trials Processor (CTP) on UQ AIS XNAT</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/</link><description>Recent content in Clinical Trials Processor (CTP) on UQ AIS XNAT</description><generator>Hugo</generator><language>en</language><atom:link href="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/index.xml" rel="self" type="application/rss+xml"/><item><title>Installation</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/installation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/installation/</guid><description>&lt;h3 id="installing-ctp-on-windows-10"&gt;Installing CTP on Windows 10&lt;/h3&gt;
&lt;p&gt;CTP installation steps&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Create a new user for CTP on UQ RCC XNAT (not an AAF/OpenID user) with required project access, without admin access&lt;/li&gt;
&lt;li&gt;Download the following files
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/johnperry/CTP/raw/master/products/CTP-installer.jar"&gt;CTP-installer.jar&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Australian-Imaging-Service/configuration/raw/0c784a9bdd817ee5e0534034a5a108b4a1c6f4aa/CTP/ctp_clinical_site_to_xnat_config.xml"&gt;ctp_clinical_site_to_xnat_config.xml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://dicom.offis.de/download/dcmtk/dcmtk366/bin/dcmtk-3.6.6-win64-dynamic.zip"&gt;dcmtk-3.6.6-win64-dynamic.zip&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.rubomedical.com/dicom_files/dicom_viewer_Mrbrain.zip"&gt;dicom_viewer_Mrbrain.zip&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Optional if you need more DICOM samples: &lt;a href="https://download.nrg.wustl.edu/pub/data/sample1.zip"&gt;sample1.zip&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Install CTP using:
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd INSTALL_FOLDER (replace with your actual folder)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;java -jar CTP-installer.jar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Replace CTP/config.xml with ctp_clinical_site_to_xnat_config.xml&lt;/li&gt;
&lt;li&gt;Edit CTP/config.xml
&lt;ul&gt;
&lt;li&gt;Change &amp;ldquo;xxxx.xxxx&amp;rdquo; in two &amp;ldquo;url&amp;rdquo; tags to &amp;ldquo;xnat.rcc.uq.edu.au&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Change &amp;ldquo;xxxx&amp;rdquo; username and password tags to match new user from step 1&lt;/li&gt;
&lt;li&gt;If CTP internet access is via a proxy server, add the proxy server element to the Server config
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;Server ...&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;ProxyServer
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; proxyIPAddress=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; proxyPort=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; proxyUsername=&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; proxyPassword=&amp;#34;&amp;#34;/&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;/Server&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;Once this element is added proxy server settings can be updated in the CTP Launcher GUI&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Add CTP the anonymiser script
&lt;ul&gt;
&lt;li&gt;Copy CTP/scripts/DicomServiceAnonymizer.script to CTP/scripts/dicom-anonymizer-sender.script&lt;/li&gt;
&lt;li&gt;Add the PROJECTID parameter to the list of parameters at the start of the file
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;p t=&amp;quot;PROJECTID&amp;quot;&amp;gt;my xnat project id&amp;lt;/p&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Change the PatientComments element 0010,4000 to set XNAT project routing info
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@always()@append(){Project:@param(@PROJECTID) Subject:@contents([0010,0010]) Session:@contents([0008,0050])}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Review/set other parameters at the start of the file
&lt;ul&gt;
&lt;li&gt;PROFILENAME, eg. AIS-Clinical-Site-210604&lt;/li&gt;
&lt;li&gt;DATEINC, eg. 0&lt;/li&gt;
&lt;li&gt;PROJECTNAME, SITEID, SITENAME, TRIALNAME, TRIALSPONSOR as required&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Optional: review script to check anonymisation settings are appropriate&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Start CTP GUI
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;java -jar Launcher.jar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Click the CTP &amp;ldquo;Start&amp;rdquo; button&lt;/li&gt;
&lt;li&gt;Click the &amp;ldquo;CTP Home Page&amp;rdquo; button to open the Web UI
&lt;ul&gt;
&lt;li&gt;If the browser can&amp;rsquo;t connect, check CTP is not already running, or try changing the Server port&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Login
&lt;ul&gt;
&lt;li&gt;Top RHS banner should show &amp;ldquo;Welcome admin&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Optional: click &amp;ldquo;User Manager&amp;rdquo; to change default usernames/passwords&lt;/li&gt;
&lt;li&gt;Optional: click &amp;ldquo;DICOM Anonymizer&amp;rdquo; to view/edit anonymiser script&lt;/li&gt;
&lt;li&gt;Unzip DCMTK and MrBrain dicom sample&lt;/li&gt;
&lt;li&gt;Try sending an dicom to CTP using dcmtk
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd dcmtk-3.6.5-win64-dynamic/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dcmsend localhost 25055 ../../dicom_viewer_Mrbrain/MRBRAIN.DCM
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Login to the XNAT server with an admin account to view Prearchive
&lt;ul&gt;
&lt;li&gt;Use &amp;ldquo;Upload&amp;rdquo; → &amp;ldquo;Go to prearchive&amp;rdquo;&lt;/li&gt;
&lt;li&gt;DICOM should appear in &amp;ldquo;Receiving&amp;rdquo; status, with project id assigned from step 6
&lt;ul&gt;
&lt;li&gt;Optional: non-admin users need to search by subject/etc&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Use Refresh to check when &amp;ldquo;Ready&amp;rdquo; or it disappears from list (as it has been routed to the project)&lt;/li&gt;
&lt;li&gt;Debugging: use dcm2xml from DCMTK to check anonymised dicom file under CTP/roots/FileAfterAnonymization25055&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Logout and login with the new XNAT user from step 1&lt;/li&gt;
&lt;li&gt;Navigate to the project set in step 6
&lt;ul&gt;
&lt;li&gt;You should see the dicom listed as subject &amp;ldquo;1737775597&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Use subject &amp;ldquo;1737775597&amp;rdquo; → &amp;ldquo;MR Session&amp;rdquo; → &amp;ldquo;View Images&amp;rdquo; to view the uploaded image&lt;/li&gt;
&lt;li&gt;Try a dicom send from the scanner using PC address and port 25055 (check windows firewall settings?)&lt;/li&gt;
&lt;li&gt;Enable CTP as a Windows Service. Instructions &lt;a href="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service/"&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="further-information"&gt;Further information&lt;/h3&gt;
&lt;p&gt;If you need a different commit of CTP-installer&lt;/p&gt;</description></item><item><title>Proxy Server Settings</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/proxy-server/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/proxy-server/</guid><description>&lt;p&gt;If CTP uses a proxy server for internet access, you can update the CTP proxy server settings on Windows as follows&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Stop the CTP Windows service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If you already have a Services short-cut on the Windows desktop, double-click the short-cut to start Windows Services&lt;/li&gt;
&lt;li&gt;If not, click the Windows start button, start typing &amp;ldquo;services&amp;rdquo; and the Services App icon should appear
&lt;ul&gt;
&lt;li&gt;Click the Services App icon to start Windows Services&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Locate the CTP service in the list of services, right-click and select &lt;strong&gt;Stop&lt;/strong&gt; from the context menu&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Start the CTP Launcher&lt;/p&gt;</description></item><item><title>Windows Service</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service/</guid><description>&lt;p&gt;The CTP install.bat script uses Apache procrun. Use the following steps to enable CTP as a Windows service, including an update to use a JRE other than system default (leave out step 2 if using the system default JRE)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install CTP
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;java -jar CTP-installer.jar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;To use JRE other than system default, edit &lt;code&gt;&amp;lt;ctp-home&amp;gt;/windows/install.bat&lt;/code&gt;. Find the &amp;ndash;Jvm=auto, add &amp;ndash;JavaHome entry and set both as follows
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;--JavaHome=&amp;#34;&amp;lt;jre home&amp;gt; &amp;#34; ^
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;--Jvm=&amp;#34;&amp;lt;jre-home&amp;gt;\bin\server\jvm.dll&amp;#34; ^
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;^ is needed to wrap/continue command line in batch file&lt;/li&gt;
&lt;li&gt;The jvm.dll location under &lt;jre-home&gt; is the same for JRE 1.7 and 1.8 installs. Confirm this is the case for other JREs/JDKs&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Run install.bat as Administrator to create the CTP windows service
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cd &amp;lt;ctp-home&amp;gt;/windows
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Open Windows Services as Administrator and start the CTP service&lt;/li&gt;
&lt;li&gt;Open CTP administration page in Web browser&lt;/li&gt;
&lt;li&gt;Confirm the correct JRE is reported in Admin → System Properties and/or Admin → Log Viewer → ctp.log&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="troubleshooting"&gt;Troubleshooting&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Installation paths are set in install.bat during CTP install so it won&amp;rsquo;t work if you move the CTP folder somewhere else after install&lt;/li&gt;
&lt;li&gt;If removing the service (with uninstall.bat) leaves the service stuck in delete pending state, reboot the system to complete&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="further-information"&gt;Further information&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://mircwiki.rsna.org/index.php?title=Running_CTP_as_a_Windows_Service"&gt;Running CTP as a Windows service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://commons.apache.org/proper/commons-daemon/procrun.html"&gt;Apache procrun&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Linux Service</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/linux-service/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/linux-service/</guid><description>&lt;h2 id="ubuntu"&gt;Ubuntu&lt;/h2&gt;
&lt;p&gt;Open &lt;code&gt;./linux/ctpService-ubuntu.sh&lt;/code&gt;. Update the following parameters:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;USER=ubuntu
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;CTP_HOME=/opt/ctp/CTP
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;JAVA_BIN=/usr/lib/jvm/java-17-openjdk-amd64/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;JAVA=$JAVA_BIN/java
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;CTP_PID=$CTP_HOME/ctp.pid
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Run the following to install the ctpService into init.d&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo ln -s ./linux/ctpService-ubuntu.sh /etc/init.d/ctpService
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo update-rc.d ctpService defaults 98 02
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Start and stop CTP using the following commands&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo service ctpService start
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;sudo service ctpService stop
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item></channel></rss>